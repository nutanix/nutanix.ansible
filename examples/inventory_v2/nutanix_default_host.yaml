---
plugin: nutanix.ncp.ntnx_prism_vm_inventory_v2
# nutanix_host: hostname # Or set NUTANIX_HOST or NUTANIX_HOSTNAME environment variable
# nutanix_username: username # Or set NUTANIX_USERNAME environment variable
# nutanix_password: password # Or set NUTANIX_PASSWORD environment variable
# nutanix_port: port # Or set NUTANIX_PORT environment variable
# validate_certs: false # Or set NUTANIX_VALIDATE_CERTS environment variable
# If fetch_all_vms is true, page and limit are ignored and all VMs will be fetched from the cluster.
fetch_all_vms: true

# Compose is used to define the host variables.
compose:
  # Set ansible_user to 'ansible_user' for all VMs.
  ansible_user: "'ansible_user'"
  # Convert memory_size_bytes to memory_gb and store in memory_gb variable.
  memory_gb: memory_size_bytes / 1073741824 if memory_size_bytes else 0

# Strict is used to enable strict mode.
strict: true

# Groups are used to group the VMs by power state, memory size, and machine type or whatever you want to group by.
groups:
  # Create a group for powered on VMs.
  powered_on: power_state == 'ON'
  # Create a group for powered off VMs.
  powered_off: power_state == 'OFF'
  # Create a group for VMs with memory size greater than 8GB.
  high_memory: memory_size_bytes > 8589934592 # > 8GB
  # Create a group for VMs with memory size less than or equal to 8GB.
  low_memory: memory_size_bytes <= 8589934592 # <= 8GB

# Keyed groups are used to group the VMs by machine type.
# Lets say we have 3 machine types: PC, PSERIES, and Q35.
# We can group the VMs by machine type by adding the following keyed groups:
# - key: machine_type
#   prefix: machine
#   separator: "_"
# This will create the following groups:
# - machine_PC
# - machine_PSERIES
# - machine_Q35
# and if we have only machine_PC, then we will have only machine_PC group.
keyed_groups:
  - key: machine_type
    prefix: machine
    separator: "_"