---
- name: Start ntnx_password_manager_v2 tests
  ansible.builtin.debug:
    msg: start ntnx_password_manager_v2 tests

- name: List password status of all system users
  nutanix.ncp.ntnx_password_managers_info_v2:
  register: password_status

- name: Show password status
  ansible.builtin.debug:
    msg: "{{ password_status }}"

- name: List password status of system users with filter
  nutanix.ncp.ntnx_password_managers_info_v2:
    filter: "username eq 'admin'"
  register: list_passwords

- name: Show filtered password status
  ansible.builtin.debug:
    msg: "{{ list_passwords }}"

- name: List password status of system users with limit
  nutanix.ncp.ntnx_password_managers_info_v2:
    limit: 1
  register: limited_passwords

- name: Show limited password status
  ansible.builtin.debug:
    msg: "{{ limited_passwords }}"

- name: Store ext_id of the password manager
  ansible.builtin.set_fact:
    admin_ext_id: "{{ list_passwords.response[0].ext_id }}"

- name: Update password
  nutanix.ncp.ntnx_password_managers_v2:
    ext_id: "{{ admin_ext_id }}"
    current_password: "NewPassword.456"
    new_password: "Abhinav.123"
    state: present
  register: update_password

- name: Show updated password
  ansible.builtin.debug:
    msg: "{{ update_password }}"
